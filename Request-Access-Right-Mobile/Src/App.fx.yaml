App As appinfo:
    BackEnabled: =false
    ConfirmExit: =true
    MinScreenHeight: =320
    MinScreenWidth: =320
    OnStart: |-
        =If(
            !IsBlank(
                LookUp(
                    SP_LEVELAPPROVER,
                    IdUser.Email = User().Email && Level.Value = "Approver 1" || IdUser.Email = User().Email && Level.Value = "Approver 2" || IdUser.Email = User().Email && Level.Value = "Approver 3"
                )
            ),
            Set(
                visibleBtnApprover,
                true
            );
            Set(
                visiblecountticketApprover,
                true
            ),
            If(
                Office365Users.MyProfile().Department <> "DTS" && IsMatch(
                    Office365Users.MyProfile().JobTitle,
                    "Head of",
                    MatchOptions.Contains
                ),
                Set(
                    visibleBtnHOD,
                    true
                );
                Set(
                    visiblecountticketApprover,
                    true
                ),
                Set(
                    visibleBtnApprover,
                    false
                );
                Set(
                    visibleBtnHOD,
                    false
                );
                Set(
                    visiblecountticketApprover,
                    false
                )
            )
        );
        Concurrent(
            ClearCollect(
                CollectRequestAll,
                Filter(
                    SP_REQUEST,
                    'Created By'.Email = User().Email
                )
            ),
            ClearCollect(
                CollectRequestNew,
                Filter(
                    SP_REQUEST,
                    Status.Value = "Created" && 'Created By'.Email = User().Email
                )
            ),
            ClearCollect(
                CollectRequestProcess,
                Filter(
                    SP_REQUEST,
                    (Status.Value = "Created" || Status.Value = "HOD approved" || Status.Value = "Approver 1 approved" || Status.Value = "Approver 2 approved") && 'Created By'.Email = User().Email
                )
            ),
            ClearCollect(
                CollectRequestClosed,
                Filter(
                    SP_REQUEST,
                    Status.Value = "Done" && 'Created By'.Email = User().Email
                )
            ),
            ClearCollect(
                CollectRequestRejected,
                Filter(
                    SP_REQUEST,
                    Status.Value = "Rejected" && 'Created By'.Email = User().Email
                )
            ),
            ClearCollect(
                CollectRequestApprover1,
                Filter(
                    SP_REQUEST,
                    Status.Value = "Created" && User().Email = 'Approver 1'.Email || Status.Value = "HOD approved" && User().Email = 'Approver 1'.Email
                )
            ),
            ClearCollect(
                CollectRequestApprover2,
                Filter(
                    SP_REQUEST,
                    Status.Value = "Approver 1 approved"
                )
            ),
            ClearCollect(
                CollectRequestApprover3,
                Filter(
                    SP_REQUEST,
                    Status.Value = "Approver 2 approved" && 'ReqType: ID'.Value = "2"
                )
            ),
            ClearCollect(
                CollectRequestHOD,
                Filter(
                    SP_REQUEST,
                    Status.Value = "Created" && HOD.Email = User().Email
                )
            ),
            ClearCollect(
                CollecRequestHistory_Approver1,
                Filter(
                    SP_REQUEST,
                    User().Email = 'Approver 1'.Email && 'Approved Date 1' <> Blank() || User().Email = 'Rejected By'.Email && 'Rejected Date' <> Blank()
                )
            ),
            ClearCollect(
                CollecRequestHistory_Approver2,
                Filter(
                    SP_REQUEST,
                    User().Email = 'Approver 2'.Email && 'Approved Date 2' <> Blank() || User().Email = 'Rejected By'.Email && 'Rejected Date' <> Blank()
                )
            ),
            ClearCollect(
                CollecRequestHistory_Approver3,
                Filter(
                    SP_REQUEST,
                    User().Email = 'Approver 3'.Email && 'Approved Date 3' <> Blank() && 'ReqType: ID'.Value = "2" || User().Email = 'Rejected By'.Email && 'Rejected Date' <> Blank()
                )
            ),
            ClearCollect(
                CollecRequestHistory_HOD,
                Filter(
                    SP_REQUEST,
                    User().Email = HOD.Email && 'HOD Approved Date' <> Blank() || User().Email = 'Rejected By'.Email && 'Rejected Date' <> Blank()
                )
            )
        );
        Set(
            AppID,
            "GUID"
        );
        If(
            Not(IsBlank(Param("accountId"))),
            Set(
                accountId,
                Param("accountId")
            )
        )
    StartScreen: =
    Theme: =PowerAppsTheme

    Host As hostControl.DefaultHostControlVariant:
        OnCancel: =false
        OnEdit: =false
        OnNew: =false
        OnSave: =false
        OnView: =false

